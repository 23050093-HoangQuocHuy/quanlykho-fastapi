{% extends "base.html" %}
{% block title %}B·∫£ng ƒëi·ªÅu khi·ªÉn{% endblock %}
{% block content %}

<!-- JSON data for charts -->
<script id="dashboard-data" type="application/json">
  {{ {
    "category_labels": category_labels,
    "category_counts": category_counts,
    "price_ranges": price_ranges,
    "price_counts": price_counts,
    "top_suppliers": supplier_overview.top_suppliers
  } | tojson }}
</script>

<div class="max-w-7xl mx-auto px-4 py-6">
  <h1 class="text-3xl font-bold mb-6 text-center dark:text-gray-100">
    üìä B·∫£ng ƒëi·ªÅu khi·ªÉn kho h√†ng
  </h1>

  <!-- Key Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white dark:bg-gray-800 dark:text-gray-100 p-6 rounded shadow">
      <h2 class="text-xl font-semibold mb-2">T·ªïng gi√° tr·ªã kho h√†ng</h2>
      <p class="text-2xl font-bold text-blue-600">
        {{ "{:,.0f}".format(total_inventory_value) }} VND
      </p>
    </div>

    <div class="bg-white dark:bg-gray-800 dark:text-gray-100 p-6 rounded shadow">
      <h2 class="text-xl font-semibold mb-2">T·ªïng s·ªë nh√† cung c·∫•p</h2>
      <p class="text-2xl font-bold text-green-600">
        {{ supplier_overview.unique_suppliers }}
      </p>
    </div>
  </div>

  <!-- Charts -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
      <canvas id="categoryChart"></canvas>
      <p class="text-sm text-center mt-2 dark:text-gray-300">
        Ph√¢n b·ªë s·∫£n ph·∫©m theo danh m·ª•c
      </p>
    </div>

    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center justify-center">
      <canvas id="priceChart" class="w-full max-w-xs h-40"></canvas>
      <p class="text-sm text-center mt-4 dark:text-gray-300">
        Th·ªëng k√™ theo m·ª©c gi√°
      </p>
    </div>

    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
      <canvas id="supplierChart"></canvas>
      <p class="text-sm text-center mt-2 dark:text-gray-300">
        Top nh√† cung c·∫•p
      </p>
    </div>
  </div>

  <!-- Low stock -->
  <div class="mt-10 bg-white dark:bg-gray-800 px-4 py-3 rounded shadow max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-3 text-center">
      ‚ö†Ô∏è S·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng
    </h2>

    {% if low_stock_items %}
      <ul class="space-y-2">
        {% for item in low_stock_items %}
          <li class="text-red-600 text-sm">
            üîª {{ item.name }} (SL: {{ item.quantity }})
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-center text-gray-500 text-sm">
        Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o s·∫Øp h·∫øt h√†ng
      </p>
    {% endif %}
  </div>

  <!-- Recent items -->
  <div class="mt-10 bg-white dark:bg-gray-800 p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">
      üïí S·∫£n ph·∫©m m·ªõi th√™m
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      {% for item in recent_items %}
        <div class="border dark:border-gray-600 p-4 rounded hover:shadow-lg transition">
          <h3 class="font-semibold">{{ item.name }}</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">
            SL: {{ item.quantity }} ¬∑ {{ "{:,.0f}".format(item.price) }} VND
          </p>
          <p class="text-xs text-gray-400">
            Ng√†y th√™m: {{ item.created_at.strftime('%Y-%m-%d') }}
          </p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
